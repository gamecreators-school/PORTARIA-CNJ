<!DOCTYPE html> <html lang="pt-BR"> <head> <meta charset="UTF-8"> <meta name="viewport" content="width=device-width, initial-scale=1.0"> <title>Sistema de Controle de Portaria Escolar</title> <style> * { margin: 0; padding: 0; box-sizing: border-box; } body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; color: #333; } .container { max-width: 1200px; margin: 0 auto; padding: 20px; } .header { text-align: center; margem inferior: 30px; cor: branco; } .cabe√ßalho h1 { tamanho da fonte: 2,5 rem; margem inferior: 10 px; sombra do texto: 0 2px 4px rgba(0,0,0,0.3); } .cabe√ßalho p { tamanho da fonte: 1,1 rem; opacidade: 0,9; } .cart√£o principal { plano de fundo: branco; raio da borda: 20 px; preenchimento: 40 px; sombra da caixa: 0 20 px 40 px rgba(0,0,0,0.1); margem inferior: 30 px; } .formul√°rio de entrada { alinhamento do texto: centralizado; largura m√°xima: 600 px; margem: 0 autom√°tico; } .seletor de tipo de usu√°rio { exibi√ß√£o: flex; conte√∫do justificado: centralizado; lacuna: 15 px; margem inferior: 30 px; envolt√≥rio flex√≠vel: envolver; } .user-type-btn { preenchimento: 12px 20px; borda: 2px s√≥lido #e1e5e9; raio da borda: 12px; plano de fundo: #f8f9fa; cursor: ponteiro; transi√ß√£o: todos 0,3s facilidade; espessura da fonte: 600; largura m√≠nima: 140px; tamanho da fonte: 0,9rem; } .user-type-btn.active { plano de fundo: #667eea; cor: branco; cor da borda: #667eea; } .user-type-btn: pairar { transformar: traduzirY(-2px); sombra da caixa: 0 5px 15px rgba(0,0,0,0.1); } .form-group { margem inferior: 25px; } .form-group r√≥tulo { exibi√ß√£o: bloco; margem inferior: 8px; espessura da fonte: 600; cor: #555; tamanho da fonte: 1,1 rem; } .form-group entrada, .form-group sele√ß√£o { largura: 100%; preenchimento: 15px 20px; borda: 2px s√≥lido #e1e5e9; raio da borda: 12px; tamanho da fonte: 1,1 rem; transi√ß√£o: todos 0,3s facilidade; plano de fundo: #f8f9fa; } .form-group entrada: foco, .form-group sele√ß√£o: foco { contorno: nenhum; cor da borda: #667eea; plano de fundo: branco; sombra da caixa: 0 0 0 3px rgba(102, 126, 234, 0.1); } .button-group { display: flex; gap: 20px; justify-content: center; flex-wrap: wrap; } .btn { padding: 15px 30px; border: none; border-radius: 12px; font-size: 1.1rem; font-weight: 600; cursor: pointer; transition: all 0.3s ease; display: flex; align-items: center; gap: 10px; min-width: 180px; justify-content: center; } .btn-entry { background: linear-gradient(135deg, #4CAF50, #45a049); color: white; } .btn-entry:hover { transform: translateY(-2px); box-shadow: 0 8px 25px rgba(76, 175, 80, 0.3); } .btn-exit { plano de fundo: gradiente linear (135 graus, #ff6b6b, #ee5a52); cor: branco; } .btn-exit: pairar { transformar: traduzir Y (-2 px); sombra da caixa: 0,8 px, 25 px rgba (255, 107, 107, 0,3); } .btn-admin { plano de fundo: gradiente linear (135 graus, #667eea, #764ba2); cor: branco; margem superior: 20 px; } .btn-admin: pairar { transformar: traduzir Y (-2 px); sombra da caixa: 0,8 px, 25 px rgba (102, 126, 234, 0,3); } .btn-secund√°rio { plano de fundo: #6c757d; cor: branco; } .btn-secondary:hover { plano de fundo: #5a6268; transformar: traduzirY(-2px); } .btn-primary { plano de fundo: #007bff; cor: branco; } .btn-primary:hover { plano de fundo: #0056b3; transformar: traduzirY(-2px); } .btn-success { plano de fundo: #28a745; cor: branco; } .btn-success:hover { plano de fundo: #218838; transformar: traduzirY(-2px); } .admin-panel { exibir: nenhum; } .admin-header { exibir: flex; justificar-conte√∫do: espa√ßo-entre; alinhar-itens: centralizar; margem-inferior: 30px; flex-wrap: envolver; lacuna: 15px; } .admin-header h2 { cor: #333; tamanho-da-fonte: 2rem; } .admin-actions { display: flex; gap: 15px; flex-wrap: wrap; } .config-section { background: white; padding: 25px; border-radius: 15px; margin-bottom: 30px; box-shadow: 0 5px 15px rgba(0,0,0,0.08); } .config-section h3 { margin-bottom: 15px; color: #333; } .filter-section { background: white; padding: 25px; border-radius: 15px; margin-bottom: 30px; box-shadow:0 5px 15px rgba(0,0,0,0.08); } .filter-controls { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 20px; } .visitor-section { background: white; padding: 25px; border-radius: 15px; margin-bottom: 30px; box-shadow: 0 5px 15px rgba(0,0,0,0.08); } .visitor-form { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px; margin-bottom: 20px; } .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 30px; } .stat-card { background: white; padding: 25px; border-radius: 15px; box-shadow: 0 5px 15px rgba(0,0,0,0.08); text-align: center; } .stat-number { font-size: 2.2rem; font-weight: bold; color: #667eea; margin-bottom: 5px; } .stat-label { color: #666; font-size: 0.9rem; } .records-table { background: white; border-radius: 15px; overflow: hidden; box-shadow: 0 5px 15px rgba(0,0,0,0.08); } .table-header { background: #667eea; cor: branco; preenchimento: 20px; espessura da fonte: 600; exibi√ß√£o: flex; justificar conte√∫do: espa√ßo entre; alinhar itens: centro; } .table-content { altura m√°xima: 500px; estouro-y: autom√°tico; } .record-item { preenchimento: 12px 20px; borda inferior: 1px s√≥lido #eee; exibi√ß√£o: grade; colunas do modelo de grade: 1fr 1fr 2fr 1,5fr 2fr 1fr 1fr 1fr 1fr; lacuna: 10px; alinhar itens: centro; tamanho da fonte: 0,85rem; } .record-item: pairar { background: #f8f9fa; } .status-entrada { background: #d4edda; cor: #155724; preenchimento: 3px 6px; raio da borda: 6px; tamanho da fonte: 0,75 rem; espessura da fonte: 600; } . status-saida { plano de fundo: #f8d7da; cor: #721c24; preenchimento: 3px 6px; raio da borda: 6px; tamanho da fonte: 0,75 rem; espessura da fonte: 600; } . type-aluno { plano de fundo: #cce5ff; cor: #004085; preenchimento: 3px 6px; raio da borda: 6px; tamanho da fonte: 0,75 rem; espessura da fonte: 600; } . type-colaborador { plano de fundo: #fff3cd; cor: #856404; preenchimento: 3px 6px; raio da borda:6px; tamanho da fonte: 0,75 rem; espessura da fonte: 600; } .type-visitante { plano de fundo: #e2e3e5; cor: #383d41; preenchimento: 3px 6px; raio da borda: 6px; tamanho da fonte: 0,75 rem; espessura da fonte: 600; } .message { preenchimento: 15px 20px; raio da borda: 10px; margem: 20px 0; alinhamento do texto: centralizado; espessura da fonte: 600; } .message.success { plano de fundo: #d4edda; cor: #155724; borda: 1px s√≥lida #c3e6cb; } .message.error { plano de fundo: #f8d7da; cor: #721c24; borda: 1px s√≥lida #f5c6cb; } .login-form { largura m√°xima: 400px; margem: 0 autom√°tico; alinhamento de texto: centralizado; } .modal { exibi√ß√£o: nenhuma; posi√ß√£o: fixa; topo: 0; esquerda: 0; largura: 100%; altura: 100%; plano de fundo: rgba(0,0,0,0.5); √≠ndice z: 1000; } .modal-content { posi√ß√£o: absoluta; topo: 50%; esquerda: 50%; transforma√ß√£o: tradu√ß√£o(-50%, -50%); plano de fundo: branco; preenchimento: 30px; raio da borda: 15px; largura m√°xima: 500px; largura: 90%; altura m√°xima: 80vh; estouro-y: autom√°tico; } .modal-header { exibi√ß√£o: flex; conte√∫do justificado: espa√ßo entre; itens de alinhamento: centralizado; margem inferior: 20px; } .close-btn { background: none; border: none; font-size: 1.5rem; cursor: pointer; color: #666; } .loading { display: none; text-align: center; padding: 20px; } .spinner { border: 3px solid #f3f3f3; border-top: 3px solid #667eea; border-radius: 50%; width: 30px; height: 30px; animation: spin 1s linear infinite; margin: 0 auto 10px; } @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } } .chart-container { background: white; padding: 25px; border-radius: 15px; margin-bottom: 30px; box-shadow: 0 5px 15px rgba(0,0,0,0.08); } .chart-title { tamanho da fonte: 1,2 rem; espessura da fonte: 600; margem inferior: 15 px; cor: #333; } .chart-bar { display: flex; align-items: center; margem inferior: 10 px; } .chart-label { largura: 100 px; tamanho da fonte: 0,9 rem; cor: #666; } .progresso do gr√°fico { flex: 1; altura: 20px; plano de fundo: #e9ecef; raio da borda: 10px; margem: 0 10px; estouro: oculto; } . preenchimento do gr√°fico { altura: 100%; plano de fundo: gradiente linear (135 graus, #667eea, #764ba2); raio da borda: 10px; transi√ß√£o: largura 0,5s facilidade; } . valor do gr√°fico { tamanho da fonte: 0,9rem; espessura da fonte: 600; cor: #333; largura m√≠nima: 30px; } @ m√≠dia (largura m√°xima: 768px) { . cont√™iner { preenchimento: 15px; } . cabe√ßalho h1 { tamanho da fonte: 2rem; } . cart√£o principal { preenchimento: 25px; } . grupo de bot√µes { dire√ß√£o flex√≠vel: coluna; alinhar-itens: centro; } .btn { largura: 100%; largura m√°xima: 300px; } .seletor-tipo-de-usu√°rio { dire√ß√£o-flex√≠vel: coluna; alinhar-itens: centro; } .btn tipo-de-usu√°rio { largura: 100%; largura m√°xima: 300px; } .item-de-registro { colunas-modelo-de-grade: 1fr; lacuna: 8px; alinhamento-de-texto: centro; } .cabe√ßalho-administrador { dire√ß√£o-flex√≠vel: coluna; alinhamento-de-texto: centro; } .a√ß√µes-administrador { justificar-conte√∫do: centro; } .grade-estat√≠sticas { colunas-modelo-de-grade: 1fr; } .controles-de-filtro { colunas-modelo-de-grade: 1fr; } .formul√°rio-visitante { colunas-modelo-de-grade: 1fr; } } </style> </head> <body> <div class="container"> <div class="header"> <h1>üè´ Sistema de Controle de Portaria</h1> <p>Registro de entrada e sa√≠da de estudantes, colaboradores e visitantes</p> </div> <!-- Tela Principal --> <div id="main-screen"> <div class="main-card"> <div class="entry-form"> <div class="user-type-selector"> <button class="user-type-btn active" onclick="selectUserType('aluno')"> üë®‚Äçüéì Aluno </button> <button class="user-type-btn" onclick="selectUserType('colaborador')"> üë®‚Äçüíº Colaborador </button> <button class="user-type-btn" onclick="selectUserType('visitante')"> üë• Visitante </button> </div> <div id="standard-form"> <div class="form-group"> <label for="id-input" id="id-label">Registro Acad√™mico (RA)</label> <input type="text" id="id-input" placeholder="Digite o RA do estudante" maxlength="20"> </div> <div class="button-group"> <button class="btn btn-entry" onclick="registerEntry()"> <span>üì•</span> Registrar Entrada </button> <button class="btn btn-exit" onclick="registerExit()"> <span>üì§</span> Registrar Sa√≠da </button> </div> </div> <div id="visitor-form" style="display:none;"> <div class="form-group"> <label for="visitor-name">Nome do Visitante</label> <input type="text" id="visitor-name" placeholder="Digite o nome completo"> </div> <div class="form-group"> <label for="visitor-phone">Telefone</label> <input type="tel" id="visitor-phone" placeholder="(11) 99999-9999"> </div> <div class="form-group"> <label for="visitor-guardian">Respons√°vel (se menor de idade)</label> <input type="text" id="visitor-guardian" placeholder="Nome do respons√°vel (opcional)"> </div> <div class="button-group"> <button class="btn btn-entry" onclick="registerVisitorEntry()"> <span>üì•</span> Registrar Entrada </button> <button class="btn btn-exit" onclick="registerVisitorExit()"> <span>üì§</span> Sa√≠da do Registrador </button> </div> </div> <button class="btn btn-admin" onclick="showAdminLogin()"> <span>‚öôÔ∏è</span> √Årea do Administrador </button> </div> </div> <div id="message-container"></div> </div> <!-- Tela de Login do Administrador --> <div id="admin-login" style="display: none;"> <div class="main-card"> <div class="login-form"> <h2 style="margin-bottom: 20px; color:#333;">Acesso do Administrador</h2> <div class="form-group"> <label for="admin-password">Senha</label> <input type="password" id="admin-password" placeholder="Digite a senha"> </div> <div class="button-group"> <button class="btn btn-admin" onclick="adminLogin()">Entrar</button> <button class="btn btn-secondary" onclick="showMainScreen()">Voltar</button> </div> </div> </div> </div> <!-- Painel do Administrador --> <div id="admin-panel" class="admin-panel"> <div class="admin-header"> <h2>üìä Painel do Administrador</h2> <div class="admin-actions"> <button class="btn btn-secondary" onclick="exportReport()">üìÑ Exportar Relat√≥rio</button> <button class="btn btn-secondary" onclick="showMainScreen()">üè† Voltar</button> </div> </div> <!-- Configura√ß√£o do Planilhas Google --> <div class="config-section"> <h3>‚öôÔ∏è Configura√ß√£o do Planilhas Google</h3> <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;"> <div class="form-group"> <label for="sheet-id">ID da Planilha Google Sheets</label> <input type="text" id="sheet-id" placeholder="Colete aqui o ID da sua Planilha"> </div> <div class="form-group"> <label for="script-url">URL do Google Apps Script</label> <input type="text" id="script-url" placeholder="Colete aqui a URL do seu script"> </div> </div> <button class="btn btn-primary" onclick="saveConfiguration()">üíæ Salvar Configura√ß√£o</button> </div> <!-- Se√ß√£o de Registro de Visitante --> <div class="visitor-section"> <h3>üë• Registrar Visitante</h3> <div class="visitor-form"> <div class="form-group"> <label for="admin-visitor-name">Nome</label> <input type="text" id="admin-visitor-name" placeholder="Nome completo do visitante"> </div> <div class="form-group"> <label for="admin-visitor-phone">Telefone</label> <input type="tel" id="admin-visitor-phone" placeholder="(11) 99999-9999"> </div> <div class="form-group"> <label for="admin-visitor-guardian">Respons√°vel</label> <input type="text" id="admin-visitor-guardian" placeholder="Nome do respons√°vel (se menor)"> </div> </div> <div class="button-group"> <button class="btn btn-success" onclick="adminRegisterVisitor('Entrada')">üì• Entrada</button> <button class="btn btn-secondary" onclick="adminRegisterVisitor('Sa√≠da')">üì§ Sa√≠da</button> </div> </div> <!-- Filtros --> <div class="filter-section"> <h3>üîç Buscar e Filtrar Registros</h3> <div class="filter-controls"> <div class="form-group"> <label for="search-date">Buscar por Dados</label> <input type="date" id="search-date"> </div> <div class="form-group"> <label for="filter-type">Tipo de Registro</label> <select id="filter-type"> <option value="">Todos</option> <option value="Aluno">Aluno</option> <option value="Colaborador">Colaborador</option> <option value="Visitante">Visitante</option> </select> </div> <div class="form-group"> <label for="filter-movement">Tipo de Movimento</label> <select id="filter-movement"> <option value="">Todos</option> <option value="Entrada">Entrada</option> <option value="Sa√≠da">Sa√≠da</option> </select> </div> </div> <div class="button-group"> <button class="btn btn-primary" onclick="applyFilters()">üîç Aplicar Filtros</button> <button class="btn btn-secondary" onclick="filterPreviousDay()">üìÖ Dia Anterior</button> <button class="btn btn-secondary" onclick="filterCurrentMonth()">üìä M√™s Atual</button> <button class="btn btn-secondary" onclick="clearFilters()">üóëÔ∏è Limpar Filtros</button> </div> </div> <!-- Estat√≠sticas --> <div class="stats-grid"> <div class="stat-card"> <div class="stat-number" id="total-entries">0</div> <div class="stat-label">Total de Entradas</div> </div> <div class="stat-card"> <div class="stat-number" id="total-exits">0</div> <div class="stat-label">Total de Sa√≠das</div> </div> <div class="stat-card"> <div class="stat-number" id="people-inside">0</div> <div class="stat-label">Pessoas na Escola</div> </div> <div class="stat-card"> <div class="stat-number" id="today-movements">0</div> <div class="stat-label">Movimentos Hoje</div> </div> <div class="stat-card"> <div class="stat-number" id="visitors-today">0</div> <div class="stat-label">Visitantes Hoje</div> </div> </div> <!-- Gr√°fico --> <div class="chart-container"> <div class="chart-title">üìà Movimenta√ß√£o por Tipo</div> <div class="chart-bar"> <div class="chart-label">Alunos</div> <div class="chart-progress"> <div class="chart-fill" id="students-bar" style="width: 0%"></div> </div> <div class="chart-value" id="students-count">0</div> </div> <div class="chart-bar"> <div class="chart-label">Colaboradores</div> <div class="chart-progress"> <div class="chart-fill" id="employees-bar" style="width:0%"></div> </div> <div class="chart-value" id="employees-count">0</div> </div> <div class="chart-bar"> <div class="chart-label">Visitantes</div> <div class="chart-progress"> <div class="chart-fill" id="visitors-bar" style="width: 0%"></div> </div> <div class="chart-value" id="visitors-count">0</div> </div> </div> <!-- Tabela de Registros --> <div class="records-table"> <div class="table-header"> <span>üìã Registros</span> <span id="records-count">0 registros</span> </div> <div class="table-content" id="records-list"> <div class="loading" id="loading"> <div class="spinner"></div> <p>Carregando registros...</p> </div> </div> </div> </div> </div> <!-- Modalidade de Edi√ß√£o --> <div id="edit-modal" class="modal"> <div class="modal-content"> <div class="modal-header"> <h3>‚úèÔ∏è Editar Informa√ß√µes</h3> <button class="close-btn" onclick="closeEditModal()">√ó</button> </div> <div class="form-group"> <label for="edit-type">Tipo de Registro</label> <select id="edit-type"> <option value="Aluno">Aluno</option> <option value="Colaborador">Colaborador</option> <option value="Visitante">Visitante</option> </select> </div> <div class="form-group"> <label for="edit-id">RA ou ID</label> <input type="text" id="edit-id" readonly> </div> <div class="form-group"> <label for="edit-nome">Nome</label> <input type="text" id="edit-nome"> </div> <div class="form-group"> <label for="edit-responsavel">Respons√°vel</label> <input type="text" id="edit-responsavel"> </div> <div class="form-group"> <label for="edit-email">E-mail</label> <input type="email" id="edit-email"> </div> <div class="form-group"> <label for="edit-telefone">Telefone</label> <input type="tel" id="edit-telefone"> </div> <div class="button-group"> <button class="btn btn-admin" onclick="savePersonInfo()">üíæ Salvar</button> <button class="btn btn-secondary" onclick="closeEditModal()">Cancelar</button> </div> </div> </div> <script> // Configura√ß√£o const ADMIN_PASSWORD = 'admin123'; deixe SCRIPT_URL = ''; deixe FOLHA_ID = ''; // Estado da aplica√ß√£o let currentUserType = 'aluno'; deixe PessoaCorrente = null; deixe todos os registros = []; deixe registros filtrados = []; // Carregar configura√ß√£o salva function loadConfiguration() { const saveScriptUrl = localStorage.getItem('scriptUrl'); const savedSheetId = localStorage.getItem('sheetId'); if (savedScriptUrl) { SCRIPT_URL = savedScriptUrl; document.getElementById('script-url').value = savedScriptUrl; } if (savedSheetId) { SHEET_ID = savedSheetId; document.getElementById('sheet-id').value = savedSheetId; } } // Salvar configura√ß√£o function saveConfiguration() { const scriptUrl = document.getElementById('script-url').value.trim(); const sheetId = document.getElementById('sheet-id').value.trim(); if (!scriptUrl || !sheetId) { showMessage('Por favor, verifique todos os campos de configura√ß√£o.', 'error'); return; } SCRIPT_URL = scriptUrl; SHEET_ID = sheetId; localStorage.setItem('scriptUrl', scriptUrl); localStorage.setItem('sheetId', sheetId); showMessage('Configura√ß√£o salva com sucesso!', 'success'); } // Sele√ß√£o do tipo de usu√°rio function selectUserType(type) { currentUserType = type; // Atualizar bot√µes document.querySelectorAll('.user-type-btn').forEach(btn => { btn.classList.remove('active'); }); event.target.classList.add('active'); // Exibir/ocultar formul√°rios if (type === 'visitante') { document.getElementById('standard-form').style.display = 'none'; document.getElementById('visitor-form').style.display = 'block'; } else { document.getElementById('formul√°rio padr√£o').style.display = 'bloco'; document.getElementById('formul√°rio-visitante').style.display = 'none'; // Atualizar r√≥tulo e placeholder const label = document.getElementById('id-label'); const entrada = document.getElementById('id-input'); if (type === 'aluno') { label.textContent = 'Registro Acad√™mico (RA)'; input.placeholder = 'Digite o RA do estudante'; } else { label.textContent = 'ID do Colaborador'; input.placeholder = 'Digite o ID do colaborador'; } entrada.valor = ''; } } // Fun√ß√µes de navega√ß√£o function showMainScreen() { document.getElementById('main-screen').style.display = 'bloco'; document.getElementById('login-admin').style.display = 'nenhum'; document.getElementById('painel-admin').style.display = 'nenhum'; clearMessages(); } function showAdminLogin() { document.getElementById('tela-principal').style.display = 'nenhum'; document.getElementById('login-admin').style.display = 'bloco'; document.getElementById('painel-admin').style.display = 'nenhum'; document.getElementById('senha-admin').value = ''; } function showAdminPanel() { document.getElementById('tela-principal').style.display = 'nenhum'; document.getElementById('login-admin').style.display = 'nenhum'; document.getElementById('painel de administra√ß√£o').style.display = 'bloquear'; carregarAdminData(); } // Fun√ß√£o de login do admin function adminLogin() { const password = document.getElementById('admin-password').value; if (senha === ADMIN_PASSWORD) { showAdminPanel(); } else { showMessage('Senha incorreta!', 'erro'); } } // Fun√ß√µes de registro async function registerEntry() { const id = document.getElementById('id-input').value.trim(); if (!id) { const fieldName = currentUserType === 'aluno' ? 'RA': 'ID do colaborador'; showMessage(`Por favor, digite ${fieldName}.`, 'erro'); retornar; } aguardar registroMovement(id, 'Entrada', currentUserType); } async function registerExit() { const id = document.getElementById('id-input').value.trim(); if (!id) { const fieldName = currentUserType === 'aluno' ? 'RA' : 'ID do colaborador'; showMessage(`Por favor, digite ${fieldName}.`, 'error'); return; } await registerMovement(id, 'Sa√≠da', currentUserType); } async function registerVisitorEntry() { const name = document.getElementById('visitor-name').value.trim(); const phone = document.getElementById('visitor-phone').value.trim(); if (!name || !phone) { showMessage('Por favor, investigue o nome e o telefone do visitante.', 'error'); return; } const guardian = document.getElementById('visitor-guardian').value.trim(); await registerVisitorMovement(nome, telefone, guardi√£o,'Entrada'); } fun√ß√£o ass√≠ncrona registerVisitorExit() { const name = document.getElementById('visitor-name').value.trim(); const phone = document.getElementById('visitor-phone').value.trim(); if (!name || !phone) { showMessage('Por favor, investigue o nome e o telefone do visitante.', 'error'); return; } const guardian = document.getElementById('visitor-guardian').value.trim(); await registerVisitorMovement(name, phone, guardian, 'Sa√≠da'); } fun√ß√£o ass√≠ncrona adminRegisterVisitor(tipo) { const name = document.getElementById('admin-visitor-name').value.trim(); const phone = document.getElementById('admin-visitor-phone').value.trim(); if (!name || !phone) { showMessage('Por favor, informe nome e telefone do visitante.', 'error'); retornar; } const guardi√£o = document.getElementById('admin-visitor-guardian').value.trim(); aguardar registroVisitorMovement(nome, telefone, respons√°vel, tipo); // Limpar campos ap√≥s registro document.getElementById('admin-visitor-name').value = ''; document.getElementById('admin-visitor-phone').value = ''; document.getElementById('admin-visitor-guardian').value = ''; } fun√ß√£o ass√≠ncrona registrarMovement(id, tipo, userType) { showLoading(true); tente { const data = { action: 'register', tipoRegistro: userType === 'aluno' ? 'Aluno' : 'Colaborador', raOuId: id, nome: '', respons√°vel: '', email: '', telefone: '', data: new Date().toLocaleDateString('pt-BR'), hora: new Date().toLocaleTimeString('pt-BR'), tipo: tipo, sheetId: SHEET_ID }; if (SCRIPT_URL) { const response = await fetch(SCRIPT_URL, { method: 'POST', headers: { 'Content-Type': 'application/json', }, body: JSON.stringify(data) }); const result = await response.json(); if (result.success) { const userTypeText = userType === 'aluno' ? 'aluno' :'colaborador'; showMessage(`${tipo} registrada com sucesso para o ${userTypeText} ${id}!`, 'success'); document.getElementById('id-input').value = ''; setTimeout(() => { showMessage(`E-mail de confirma√ß√£o enviado.`, 'sucesso'); }, 1500); } else { showMessage(result.message || 'Erro ao movimento do registrador.', 'erro'); } } else { // Simula√ß√£o sem configura√ß√£o const userTypeText = userType === 'aluno' ? 'aluno' : 'colaborador'; showMessage(`${tipo} registrado com sucesso para o ${userTypeText} ${id}! (Modo de simula√ß√£o)`, 'success'); document.getElementById('id-input').value = ''; } } catch (erro) { console.error('Erro:', erro); showMessage('Erro de conex√£o. Verifique sua internet e configura√ß√£o.', 'erro'); } showLoading(falso); } fun√ß√£o ass√≠ncrona registrarVisitorMovement(nome, telefone, guardi√£o, tipo) { showLoading(true); tente { const visitId = 'VIS' + Date.now().toString().slice(-6); const data = { action: 'cadastrar', tipoRegistro: 'Visitante', raOuId: visitId, nome: nome, responsavel: guardi√£o, email: '', telefone: telefone, dados: new Date().toLocaleDateString('pt-BR'), hora: new Date().toLocaleTimeString('pt-BR'), tipo: tipo, sheetId: SHEET_ID }; if (SCRIPT_URL) { resposta const = aguardar busca (SCRIPT_URL, { m√©todo: 'POST', cabe√ßalhos: { 'Tipo de conte√∫do': 'aplicativo/json', }, corpo: JSON.stringify (dados) }); const resultado = aguardar resposta.json(); if (result.success) { showMessage(`${tipo} de visitante registrado com sucesso para ${name}!`, 'success'); clearVisitorForm(); } else { showMessage(result.message || 'Erro ao registrador visitante.', 'error'); } } else { showMessage(`${tipo} de visitante registrado com sucesso para ${name}!(Modo simula√ß√£o)`, 'success'); clearVisitorForm(); } } catch (error) { console.error('Erro:', error); showMessage('Erro de conex√£o.', 'error'); } showLoading(false); } function clearVisitorForm() { document.getElementById('visitor-name').value = ''; document.getElementById('visitor-phone').value = ''; document.getElementById('visitor-guardian').value = ''; } // Fun√ß√µes do painel admin async function loadAdminData() { document.getElementById('loading').style.display = 'block'; try { if (!SCRIPT_URL) { const data = getSimulatedData(); allRecords = data.records; filteredRecords = [...allRecords]; } else { const response = await fetch(SCRIPT_URL, { method: 'POST', headers: { 'Content-Type': 'application/json', }, body: JSON.stringify({ action: 'getData', sheetId: SHEET_ID }) }); const data = await response.json(); allRecords = data.records || []; filteredRecords = [...allRecords]; } updateStats(filteredRecords); updateChart(filteredRecords); displayRecords(filteredRecords); } catch (error) { console.error('Erro:', error); showMessage('Erro ao carregar dados. Usando dados de exemplo.', 'error'); const data = getSimulatedData(); allRecords = data.records; filteredRecords = [...allRecords]; updateStats(filteredRecords); updateChart(filteredRecords); displayRecords(filteredRecords); } document.getElementById('loading').style.display = 'none'; } function getSimulatedData() { const today = new Date().toLocaleDateString('pt-BR'); const yesterday = new Date(Date.now() - 86400000).toLocaleDateString('pt-BR'); return { records: [ { tipoRegistro: 'Aluno', raOuId: '2023001', nome: 'Jo√£o Silva', responsavel: 'Maria Silva', email: 'maria@email.com',telefone: '(11) 99999-1111', data: hoje, hora: '08:30:00', tipo: 'Entrada' }, { tipoRegistro: 'Colaborador', raOuId: 'COL001', nome: 'Pedro Santos', responsavel: '', email: 'pedro.santos@escola.com', telefone: '(11) 99999-2222', data: hoje, hora: '07:45:00', tipo: 'Entrada' }, { tipoRegistro: 'Visitante', raOuId: 'VIS001', nome: 'Ana Costa', responsavel: 'Carlos Costa', email: '', telefone: '(11) 99999-3333', data: hoje, hora: '09:15:00', tipo: 'Entrada' }, { tipoRegistro: 'Aluno', raOuId: '2023002', nome: 'Lucas Oliveira', responsavel: 'Fernanda Oliveira', email: 'fernanda@email.com', telefone: '(11) 99999-4444', data: ontem, hora: '08:45:00', tipo: 'Entrada' }, { tipoRegistro: 'Aluno', raOuId: '2023001', nome: 'Jo√£o Silva', responsavel: 'Maria Silva', email: 'maria@email.com', telefone: '(11) 99999-1111', data: hoje, hora: '17:30:00', tipo: 'Sa√≠da' }, { tipoRegistro: 'Visitante', raOuId: 'VIS001', nome: 'Ana Costa', responsavel: 'Carlos Costa', email: '', telefone: '(11) 99999-3333', data: hoje, hora: '11:30:00', tipo: 'Sa√≠da' } ] }; } // Fun√ß√µes de filtro function applyFilters() { const searchDate = document.getElementById('search-date').valor; const filterType = document.getElementById('tipo-de-filtro').valor; const filterMovement = document.getElementById('movimento-de-filtro').valor; filteredRecords = allRecords.filter(registro => { let matches = true; if (data_de_pesquisa) { const data_de_registro = convertdata_para_ISO(registro.dados); matches = matches && data_de_registro === data_de_pesquisa; } if (tipo_de_filtro) { matches = matches && record.tipo === filterType; } if (movimento_de_filtro) { matches = matches && record.tipo === movimento_de_filtro; } return matches; }); updateStats(registros_filtrados); updateChart(registros_filtrados); displayRecords(registros_filtrados); } function filterPreviousDay() { const yesterday = new Date(Date.now() - 86400000); const yesterdayBR = yesterday.toLocaleDateString('pt-BR'); filteredRecords = allRecords.filter(record => record.data === yesterdayBR); updateStats(filteredRecords); updateChart(filteredRecords); displayRecords(filteredRecords); showMessage(`Mostrando registros do dia anterior (${yesterdayBR})`, 'success'); } function filterCurrentMonth() { const currentMonth = new Date().getMonth(); const currentYear = new Date().getFullYear(); filteredRecords = allRecords.filter(record => { const recordDate = convertBRDateToDate(record.data); return recordDate.getMonth() === currentMonth && recordDate.getFullYear() === currentYear; }); updateStats(filteredRecords); updateChart(filteredRecords); displayRecords(filteredRecords); showMessage(`Mostrando registros do m√™s atual`, 'success'); } function clearFilters() { document.getElementById('search-date').value = ''; document.getElementById('filter-type').value = ''; document.getElementById('filter-movement').value = ''; filteredRecords = [...allRecords]; updateStats(filteredRecords); updateChart(filteredRecords); displayRecords (registros filtrados); showMessage('Filtros removidos', 'sucesso'); } // Fun√ß√µes utilit√°rias de dados function convertDateToISO(brDate) { const parts = brDate.split('/'); return `${parts[2]}-${parts[1].padStart(2, '0')}-${parts[0].padStart(2, '0')}`; } function convertBRDateToDate(brDate) { const parts = brDate.split('/'); return new Date(parts[2], parts[1] - 1, parts[0]); } function updateStats(records) { const today = new Date().toLocaleDateString('pt-BR'); const entries = records.filter(r => r.tipo === 'Entrada'); const exits = records.filter(r => r.tipo === 'Sa√≠da'); const todayMovements = records.filter(r => r.data === today); const visitorToday = records.filter(r => r.data === today && r.tipoRegistro === 'Visitante'); const peopleInside = Math.max(0, entries.length - exits.length); document.getElementById('total-entries').textContent = entries.length; document.getElementById('total-exits').textContent = exits.length; document.getElementById('people-inside').textContent = peopleInside; document.getElementById('today-movements').textContent = todayMovements.length; document.getElementById('visitors-today').textContent = visitorToday.length; } function updateChart(records) { const students = records.filter(r => r.tipoRegistro === 'Aluno').length; const employees = records.filter(r => r.tipoRegistro === 'Colaborador').length; const visitors = records.filter(r => r.tipoRegistro === 'Visitante').length; const total = students + employees + visitors; if (total > 0) { const studentsPercent = (students / total) * 100; const employeesPercent = (employees / total) * 100; const visitorPercent = (visitors / total) * 100; document.getElementById('students-bar').style.width = studentsPercent + '%'; document.getElementById('employees-bar').style.width = employeesPercent + '%'; document.getElementById('visitors-bar').style.width = visitorsPercent + '%'; } document.getElementById('students-count').textContent = students; document.getElementById('employees-count').textContent = employees; document.getElementById('visitors-count').textContent = visitors; } function displayRecords(records) { const container = document.getElementById('records-list'); container.innerHTML = ''; document.getElementById('records-count').textContent = `${records.length} registros`; if (records.length === 0) { container.innerHTML = '<div style="padding: 20px; text-align: center; color: #666;">Nenhum registro encontrado.</div>'; retornar; } records.slice(0, 100).forEach(record => { const recordDiv = document.createElement('div'); recordDiv.className = 'record-item'; recordDiv.innerHTML = ` <div><span class="type-${record.tipoRegistro.toLowerCase()}">${record.tipoRegistro}</span></div> <div><strong>${record.raOuId}</strong></div> <div>${record.nome || 'Nome n√£o cadastrado'}</div> <div>${record.responsavel || 'N/A'}</div> <div>${record.email || 'N/A'}</div> <div>${record.telefone || <div>${record.data}</div> <div>${record.hora}</div> <div><span class="status-${record.tipo.toLowerCase()}">${record.tipo}</span></div> `; // Adicionar evento de clique para edi√ß√£o recordDiv.addEventListener('click', () => { editPerson(record.raOuId, record.tipoRegistro); }); container.appendChild(recordDiv); }); } // Fun√ß√µes de edi√ß√£o function editPerson(id, type) { const person = allRecords.find(r => r.raOuId === id && r.tipoRegistro === type) || { raOuId: id, tipoRegistro: tipo }; PessoaAtual = pessoa; document.getElementById('edit-type').value = pessoa.tipoRegistro; document.getElementById('edit-id').value = person.raOuId; document.getElementById('edit-nome').value = pessoa.nome || ''; document.getElementById('edit-responsavel').value = pessoa.responsavel || ''; document.getElementById('edit-email').value = pessoa.email || ''; document.getElementById('edit-telefone').value = pessoa.telefone || ''; document.getElementById('edit-modal').style.display = 'block'; } function closeEditModal() { document.getElementById('edit-modal').style.display = 'none'; currentPerson = null; } async function savePersonInfo() { const personData = { action: 'updatePerson', tipoRegistro: document.getElementById('edit-type').value,raOuId: document.getElementById('edit-id').value, nome: document.getElementById('edit-nome').value, responsavel: document.getElementById('edit-responsavel').value, email: document.getElementById('edit-email').value, telefone: document.getElementById('edit-telefone').value, sheetId: SHEET_ID }; try { if (SCRIPT_URL) { const response = await fetch(SCRIPT_URL, { method: 'POST', headers: { 'Content-Type': 'application/json', }, body: JSON.stringify(personData) }); const result = await response.json(); if (result.success) { showMessage('Informa√ß√µes atualizadas com sucesso!', 'success'); closeEditModal(); carregarAdminData(); } else { showMessage(result.message || 'Erro ao atualizar informa√ß√µes.', 'error'); } } else { showMessage('Informa√ß√µes atualizadas localmente (configure Google Sheets para salvar permanentemente).', 'success'); closeEditModal(); } } catch (erro) { console.error('Erro:', erro); showMessage('Erro de conex√£o.', 'erro'); } } // Fun√ß√£o de exporta√ß√£o function exportReport() { if (filteredRecords.length === 0) { showMessage('Nenhum dado para exportar.', 'error'); retornar; } const csvContent = generateCSV(filteredRecords); downloadCSV(csvContent, 'relatorio_portaria.csv'); showMessage('Relat√≥rio exportado com sucesso!', 'success'); } function generateCSV(records) { const headers = ['Tipo de Registro', 'RA ou ID', 'Nome', 'Respons√°vel', 'E-mail', 'Telefone', 'Dados', 'Hora', 'Tipo']; const csvRows = [headers.join(',')]; records.forEach(record => { const row = [ record.tipoRegistro || '', record.raOuId || '', record.nome || '', record.responsavel || '', record.email || '', record.telefone || '', record.data || '', record.hora || '', record.tipo || '' ]; csvRows.push(row.map(field => `"${field}"`).join(',')); }); return csvRows.join('\n'); } function downloadCSV(content, filename) { const blob = new Blob([content], { type: 'text/csv;charset=utf-8;' }); const link = document.createElement('a'); const url = URL.createObjectURL(blob); link.setAttribute('href', url); link.setAttribute('download', filename); link.style.visibility = 'hidden'; document.body.appendChild(link); link.click(); document.body.removeChild(link); } // Fun√ß√µes utilit√°rias function showMessage(message, type) { const container = document.getElementById('message-container'); const messageDiv = document.createElement('div'); messageDiv.className = `message ${type}`; messageDiv.textContent = message; container.innerHTML = ''; container.appendChild(messageDiv); setTimeout(() => { messageDiv.remove(); }, 5000); } function clearMessages() { document.getElementById('message-container').innerHTML = ''; } function showLoading(show) { // Implementar loading se necess√°rio } // Event listeners document.getElementById('id-input').addEventListener('keypress', function(e) { if (e.key === 'Enter') { registerEntry(); } }); document.getElementById('admin-password').addEventListener('keypress', function(e) { if (e.key === 'Enter') { adminLogin(); } }); // Fechar modal ao clicar fora document.getElementById('edit-modal').addEventListener('click', function(e) { if (e.target === this) { closeEditModal(); } }); // Event listeners para filtros document.getElementById('search-date').addEventListener('change', applyFilters); document.getElementById('filter-type').addEventListener('change', applyFilters); document.getElementById('filter-movement').addEventListener('change', applyFilters); // Inicializa√ß√£o document.addEventListener('DOMContentLoaded', function() { loadConfiguration(); showMainScreen(); }); </script> <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'978203eff4ae011b',t:'MTc1NjcwMDg0OC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('carregando'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'carregando'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body> </html>
